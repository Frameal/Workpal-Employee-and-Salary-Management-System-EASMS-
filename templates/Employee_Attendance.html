<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workpal Attendance</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: #fffcf9;
      display: flex;
    }

    .sidebar-container {
      width: 240px;
      background-color: #fdecd2;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 30px 20px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .sidebar-logo-img {
      width: 120px;
      height: auto;
      margin-bottom: 10px;
      margin-left: 20px;
    }

    .nav-links {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: #e78f77;
      font-weight: bold;
      font-size: 20px;
      padding: 5px;
    }

    .nav-link img {
      margin-right: 8px;
      width: 20px;
      height: 20px;
    }

    .nav-link:hover {
      text-decoration: underline;
    }

    .nav-section-title {
      color: #383838;
      font-weight: bold;
      padding: 5px 0;
      margin-top: 20px; 
      font-size: 18px; 
      text-align: left; 
    }

    .logout-section {
      font-size: 18px;
      margin-top: 40px; 
    }

    .logout-link {
      text-decoration: none;
      color: #e78f77;
      font-weight: bold;
      display: flex;
      align-items: center;
      padding: 5px;
    }

    .logout-link img {
      margin-right: 8px;
      width: 20px;
      height: 20px;
    }

    .logout-link:hover {
      text-decoration: underline;
    }

    .main {
      flex: 1;
      margin-left: 240px;
      padding: 40px;
      align-items: center;
    }

    .main h1 {
      color: #e78f77;
      margin-bottom: 30px;
      font-size: 30px;
      text-align: center;
    }

    .user-info {
      background-color: #fdecd2;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 50px;
      display: block;
      font-size: 18px;
      font-weight: bold;
      color: #e78f77;
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    .time-section {
      margin-bottom: 40px;
      text-align: center;
      font-size: 20px;
      color: #383838;
      font-weight: bold;
      background-color: #fdecd2;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .time-section p {
      margin-bottom: 15px;
    }

    .time-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
    }

    .time-row .btn {
      background-color: #feded1;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 16px;
      color: #e78f77;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .time-row .btn:hover {
      background-color: #e78f77;
      color: white;
    }

    .time-row .btn:disabled {
      background-color: #ccc;
      color: #666;
      cursor: not-allowed;
    }

    .attendance-table-container {
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
      padding: 20px;
      max-height: 300px;
      overflow-y: auto;
    }

    .attendance-table {
      width: 100%;
      border-collapse: collapse;
    }

    .attendance-table th,
    .attendance-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .attendance-table th {
      background-color: #fdecd2;
      color: #e78f77;
      font-weight: bold;
    }

    .attendance-table td {
      color: #383838;
    }

    .attendance-table tr:hover {
      background-color: #fffcf9;
    }

    .work-info {
      display: flex;
      justify-content: center;
      gap: 60px;
      font-size: 18px;
      color: #383838;
      font-weight: bold;
    }

    .work-info div {
      background-color: #fdecd2;
      padding: 12px 24px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .work-info input {
      width: 80px;
      padding: 6px 10px;
      border: none;
      border-radius: 5px;
      text-align: center;
      font-size: 16px;
      background-color: #fff;
      color: #383838;
      font-weight: bold;
      pointer-events: none;
      transition: box-shadow 0.3s;
    }

    .work-info input:hover {
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }

    .message {
      text-align: center;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
    }

    .message.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <div class="sidebar-container">
    <div class="sidebar-header">
      <img src="images/logo_employee.png" alt="EASMS Logo" class="sidebar-logo-img" />
      <div class="nav-links">
        <a class="nav-link" href="{{ url_for('dashboard', employee_id=employee_id) }}">
          <img src="images/dashboard.png" />
          <span>Dashboard</span>
        </a>
        <div class="nav-section-title">Management</div>
        <a class="nav-link" href="{{ url_for('attendance', employee_id=employee_id) }}">
          <img src="images/attendance.png" alt="Attendance" />
          <span>Attendance</span>
        </a>
        <a class="nav-link" href="{{ url_for('salary', employee_id=employee_id) }}">
          <img src="images/salary.png" alt="Salary" />
          <span>Salary</span>
        </a>
      </div>
    </div>
    <div class="logout-section">
      <a class="logout-link" href="{{ url_for('home') }}">
        <img src="images/logout.png" alt="Exit Admin" />
        <span>Log out</span>
      </a>
    </div>
  </div>

  <div class="main">
    <h1>Attendance Check!</h1>
    <div class="user-info">
      <span>Name: {{ employee_name }}</span>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
      <span>Employee ID: {{ employee_id }}</span>
    </div>

    <div id="message-container"></div>

    <div class="time-section">
    <p>Current Time: <span id="current-time">00:00:00</span></p>
    <div class="time-row">
        <button class="btn" id="time-in-btn" onclick="recordTimeIn()">Time In</button>
        <button class="btn" id="time-out-btn" onclick="recordTimeOut()" disabled>Time Out</button>
    </div>
    <p>Time In: <span id="time-in-display">--:--:--</span></p>
    <p>Time Out: <span id="time-out-display">--:--:--</span></p>
    <div class="time-row">
        <button class="btn" id="submit-btn" onclick="submitAttendance()" disabled>SUBMIT</button>
    </div>
</div>

    <div class="attendance-table-container">
      <table class="attendance-table">
        <thead>
          <tr>
            <th>Date In</th>
            <th>Time In</th>
            <th>Date Out</th>
            <th>Time Out</th>
            <th>Work Hours</th>
            <th>Overtime Hours</th>
          </tr>
        </thead>
  <tbody>
    {% if attendance_logs %}
    {% for log in attendance_logs %}
      <tr>
      <tr>
      <td>{{ log.date_in_formatted }}</td>
      <td>{{ log.time_in_formatted }}</td>
      <td>{{ log.date_out_formatted }}</td>
      <td>{{ log.time_out_formatted }}</td>
      <td>{{ log.hours_worked_formatted }}</td>
      <td>{{ log.hours_overtime_formatted }}</td>
  </tr>
    </tr>
    {% endfor %}
    {% else %}
    <tr>
      <td colspan="6" style="text-align: center; color: #999;">No attendance records found</td>
    </tr>
  {% endif %}
</tbody>
      </table>
    </div>
    <div class="work-info">
    <div>Total Work Hours: <input type="text" value="{{ '%.2f'|format(total_work_hours) }}" readonly></div>
    <div>Total Overtime Hours: <input type="text" value="{{ '%.2f'|format(total_overtime_hours) }}" readonly></div>
    </div>
  </div>

<script>
    let timeInData = null;
    let timeOutData = null;

    // Update current time
    function updateCurrentTime() {
        const now = new Date();
        const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        let hours = utc8Time.getUTCHours();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        const minutes = utc8Time.getUTCMinutes().toString().padStart(2, '0');
        const seconds = utc8Time.getUTCSeconds().toString().padStart(2, '0');
        
        document.getElementById('current-time').textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
    }

    // Initialize clock
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);

    function recordTimeIn() {
        const now = new Date();
        const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        timeInData = {
            time: utc8Time.toTimeString().split(' ')[0],
            date: utc8Time.toISOString().split('T')[0],
            display: formatTimeDisplay(utc8Time)
        };
        
        document.getElementById('time-in-display').textContent = timeInData.display;
        document.getElementById('time-in-btn').disabled = true;
        document.getElementById('time-out-btn').disabled = false;
        showMessage('Time In recorded. Now click Time Out.', 'success');
    }

    function recordTimeOut() {
        const now = new Date();
        const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        timeOutData = {
            time: utc8Time.toTimeString().split(' ')[0],
            date: utc8Time.toISOString().split('T')[0],
            display: formatTimeDisplay(utc8Time)
        };
        
        document.getElementById('time-out-display').textContent = timeOutData.display;
        document.getElementById('time-out-btn').disabled = true;
        document.getElementById('submit-btn').disabled = false;
        showMessage('Time Out recorded. Click SUBMIT to save.', 'success');
    }

    function formatTimeDisplay(date) {
        let hours = date.getUTCHours();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        return `${hours}:${date.getUTCMinutes().toString().padStart(2, '0')}:${date.getUTCSeconds().toString().padStart(2, '0')} ${ampm}`;
    }

    function submitAttendance() {
        if (!timeInData || !timeOutData) {
            showMessage('Please record both Time In and Time Out', 'error');
            return;
        }

        fetch('/save_attendance', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                time_in: timeInData.time,
                date_in: timeInData.date,
                time_out: timeOutData.time,
                date_out: timeOutData.date
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage('Attendance saved successfully!', 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                showMessage('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('Error: ' + error, 'error');
        });
    }

    function showMessage(message, type) {
        const container = document.getElementById('message-container');
        container.innerHTML = `<div class="message ${type}">${message}</div>`;
        setTimeout(() => container.innerHTML = '', 5000);
    }
</script>
</body>
</html>